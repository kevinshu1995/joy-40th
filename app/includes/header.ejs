<header class="header">
    <div class="bg-black">
        <div class="container">
            <div id="cut1">
                <video id="video-desktop" class="hidden md:block w-full" src="assets/images/index/01/index.mp4"></video>
                <video id="video-mobile" class="md:hidden w-full" src="assets/images/index/01/index_m.mp4"></video>
            </div>
        </div>
    </div>
    <div class="header__elementsCuts">
        <div class="container">
            <div id="cut2" class="opacity-0 h-screen">
                <div class="container">
                    <div class="row">
                        <div class="col w-full flex-col-center">
                            <div class="py-14 text-center text-primary">
                                <h2 id="cut2_text" class="font-normal">.</h2>
                            </div>
                            <div class="text-center relative">
                                <img id="cut2_img" style="max-width:550px; filter:blur(10px)" src="assets/images/index/01/index_01_cut2_man-2.png" alt="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="cut3" class="opacity-0 h-screen">
                <div class="container">
                    <div class="row">
                        <div class="col w-full flex-col-center">
                            <div class="relative z-10 py-14 text-center text-primary tracking-widest">
                                <h2 class="font-normal text-4xl mb-1">
                                    一定要找回作夢的勇氣
                                </h2>
                                <h3 class="font-normal">
                                    # 勇敢作夢 我挺你
                                </h3>
                            </div>
                            <div class="relative z-10 text-center">
                                <div class="absolute z-0 inset-y-0 left-1/2 transform translate-x-1/4 md:translate-x-1/2 -translate-y-10 text-center text-primary">
                                    <div class="relative animate-float">
                                        <h4 class="absolute z-0 inset-0 m-auto pt-8 text-2xl font-normal">
                                            我想要
                                            <br>
                                            坐上太空船!
                                        </h4>
                                        <img src="assets/images/index/01/index_01_cut3_bubble.png" alt="">
                                    </div>
                                </div>
                                <img style="max-width:400px" src="assets/images/index/01/index_01_cut3_boy.png" alt="">
                            </div>
                            <div class="absolute z-0 inset-y-0 left-1/2 transform -translate-x-1/2">
                                <img class="h-full max-w-none animate-floatSm" src="./assets/images/index/index_01_cut3_icons.png" alt="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="cut4" class="opacity-0 ">
                <img id="cut4_arrow" class="absolute z-30 inset-x-0 bottom-0 mx-auto w-8 mb-4 animate-bounce" src="assets/images/index/01/icon_arrowDown.svg" alt="">
            </div>
        </div>
    </div>
</header>

<!-- animate note -->
<!-- 
    cut1 | just show => video end, fadeOut then hidden
    cut2 | fadeIn => wait 1sec? =>  fadeOut then add hidden
    cut3 | fadeIn => wait 1sec? =>  fadeOut then add hidden
    cut2 | fadeIn 
-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.0/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.3.4/TextPlugin.min.js"></script>
<script>
    const video = new Video()
    function showNav () {
        document.querySelector('.navWrap').classList.remove('hide')
    }

    window.onload = header_animate()
    

    function Video(){
        this.el_video_desktop = document.getElementById('video-desktop')
        this.el_video_mobile = document.getElementById('video-mobile')
        const is_mobile = window.getComputedStyle(document.getElementById('video-mobile')).display === 'block'
        this._video = is_mobile ? this.el_video_mobile : this.el_video_desktop
        this.canplay = () => {
            this._video.addEventListener('canplaythrough', function(){
                this.play();
            })
        }
        this.duration = () => {
            return this._video.duration
        }
        this.videoEnd = (fn) => {
            this._video.addEventListener('ended', function(){
                return fn()
            })
        }
    }
    
    function header_animate(){

        function cut1_video(){
            const tl = gsap.timeline()
            tl.call(video.canplay)
            return tl
        }

        function cut1(){
            const tl = gsap.timeline()
            tl.to("#cut1",{ autoAlpha:0, duration: 0.5})
                .set("#cut1 video",{ display: "none"})
            return tl
        }

        function cut2 (){
            const tl = gsap.timeline()
            tl.to("#cut2",{ autoAlpha:1 , duration: 1 }, 'cut2')
                .to("#cut2_text", { text: "假如...可以回到過去", duration: 2 },                'cut2+=1' )
                .to("#cut2_img",  { duration: .3, filter: "blur(15px)", autoRound: false },  'cut2+=1' )
                .to("#cut2_img",  { duration: .3, filter: "blur(5px)", autoRound: false },  '>'       )
                // .to("#cut2_img",  { duration: .3, filter: "blur(3px)", autoRound: false },  '>'       )
                .to("#cut2_img",  { duration: .4, filter: "blur(8px)", autoRound: false }, '>'       )
                .to("#cut2_img",  { duration: 1, filter: "blur(0.1px)", autoRound: false }, '>'       )
                .to("#cut2",{ autoAlpha:0 , duration: 1}, '+=0.5')
                .set("#cut2",{ display: "none"}, '>')
            return tl
        }

        function cut3 (){
            const tl = gsap.timeline()
            tl.to("#cut3",{ autoAlpha:1 , duration: 1.5} , 'cut3')
            return tl
        }

        function cut4 (){
            const tl = gsap.timeline()
            tl.to("#cut4", { duration: 1, opacity: 1 } )
            return tl
        }

        function cut5 (){
            const tl = gsap.timeline()
            const nav = showNav
            tl.call(nav)
            return tl
        }

        const master_video = gsap.timeline();
        const master = gsap.timeline({paused: true});
        
        master_video.add(cut1_video(), 'video')
        master.add(cut1())
            .add(cut2())
            .add(cut3())
            .add(cut4(), 'cut4')
            .add(cut5(), 'final')
        
        master_video.play()
        video.videoEnd(function (){
            return master.play()
        })
        
        // master.play('final')
        // showNav()

    }
</script>